<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>OMP 思 志 慧 念</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui" />
    <link href="css/reset.css" rel="stylesheet" />
    <script src="js/jquery.min.js"></script>
    <script src="js/libs/easeljs-0.8.1.min.js"></script>
    <script src="js/libs/tweenjs-0.6.1.min.js"></script>
    <script src="js/libs/movieclip-0.8.1.min.js"></script>
    <script src="js/libs/preloadjs-0.6.1.min.js"></script>
    <script src="js/jquery.transit.js"></script>
    <script src="js/index.js"></script>
    <script>
    var canvas, stage, exportRoot;

    function init() {
        canvas = document.getElementById("canvas");
        images = images || {};
        ss = ss || {};

        var loader = new createjs.LoadQueue(false);
        loader.addEventListener("fileload", handleFileLoad);
        loader.addEventListener("complete", handleComplete);
        loader.addEventListener("progress", handleProgress);
        loader.loadFile({src:"images/index_atlas_.json", type:"spritesheet", id:"index_atlas_"}, true);
        loader.loadFile({src:"images/index_atlas_2.json", type:"spritesheet", id:"index_atlas_2"}, true);
        loader.loadFile({src:"images/index_atlas_3.json", type:"spritesheet", id:"index_atlas_3"}, true);
        loader.loadFile({src:"images/index_atlas_4.json", type:"spritesheet", id:"index_atlas_4"}, true);
        loader.loadFile({src:"images/index_atlas_5.json", type:"spritesheet", id:"index_atlas_5"}, true);
        loader.loadFile({src:"images/index_atlas_6.json", type:"spritesheet", id:"index_atlas_6"}, true);
        loader.loadFile({src:"images/index_atlas_7.json", type:"spritesheet", id:"index_atlas_7"}, true);
        loader.loadFile({src:"images/index_atlas_8.json", type:"spritesheet", id:"index_atlas_8"}, true);
        loader.loadFile({src:"images/index_atlas_9.json", type:"spritesheet", id:"index_atlas_9"}, true);
        loader.loadFile({src:"images/index_atlas_10.json", type:"spritesheet", id:"index_atlas_10"}, true);
        loader.loadFile({src:"images/index_atlas_11.json", type:"spritesheet", id:"index_atlas_11"}, true);
        loader.loadManifest(lib.properties.manifest);
    }

    function handleFileLoad(evt) {
        if (evt.item.type == "image") {
            images[evt.item.id] = evt.result;
        }
    }

    function handleComplete(evt) {
        var queue = evt.target;
        ss["index_atlas_"] = queue.getResult("index_atlas_");
        ss["index_atlas_2"] = queue.getResult("index_atlas_2");
        ss["index_atlas_3"] = queue.getResult("index_atlas_3");
        ss["index_atlas_4"] = queue.getResult("index_atlas_4");
        ss["index_atlas_5"] = queue.getResult("index_atlas_5");
        ss["index_atlas_6"] = queue.getResult("index_atlas_6");
        ss["index_atlas_7"] = queue.getResult("index_atlas_7");
        ss["index_atlas_8"] = queue.getResult("index_atlas_8");
        ss["index_atlas_9"] = queue.getResult("index_atlas_9");
        ss["index_atlas_10"] = queue.getResult("index_atlas_10");
        ss["index_atlas_11"] = queue.getResult("index_atlas_11");
        exportRoot = new lib.index();

        stage = new createjs.Stage(canvas);
        stage.addChild(exportRoot);
        stage.update();

        createjs.Ticker.setFPS(lib.properties.fps);
        createjs.Ticker.addEventListener("tick", stage);
    }

    function handleProgress(evt) {
        var loaded = Math.floor(evt.loaded * 100);
        $(".progress").text(loaded + "%");

    }
    </script>
</head>

<body onload="init();" style="background-color:#D4D4D4">
    <div class="site-body">
        <div id="minisite">
            <!-- bigBgBody start -->
            <div id="bigBgBody" class="big-bg-body">
                <canvas id="canvas" width="640" height="1039"></canvas>
            </div>
            <!-- bigBgBody end -->
            <!-- loadBody start -->
            <div id="loadBody" class="load-body">
                <div class="load-watch-main">
                    <div class="progress">0%</div>
                </div>
            </div>
            <!-- loadBody end -->
        </div>
    </div>
    <script type="text/javascript">
    function onResize() {
        var domwidth = document.documentElement.clientWidth;
        var domheight = document.documentElement.clientHeight;

        var scale = Math.max(domwidth / 320, domheight / 504);
        var width = 320 * scale;
        var height = 504 * scale;
        $minisite.css({
            scale: [scale, scale],
            left: -(width - domwidth) / 2,
            top: -(height - domheight) / 2
        });

    }

    $minisite = $('#minisite');
    $(window).resize(onResize);
    onResize();
    </script>
</body>

</html>
